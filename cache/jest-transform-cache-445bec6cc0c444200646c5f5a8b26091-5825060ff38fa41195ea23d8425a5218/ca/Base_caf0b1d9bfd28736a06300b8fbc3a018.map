{"version":3,"names":["Base","navigation","useNavigation","useState","posts","setPosts","currentpage","setPage","fetched","setFetched","loading","setLoading","currentPageRef","useRef","delayTime","cache","hasMore","setHasMore","useEffect","AsyncStorage","getItem","then","data","postsCache","JSON","parse","currentTime","Date","getTime","timestamp","getData","setTimeout","current","clearTimeout","axios","get","resultSet","hits","length","setItem","stringify","tableHead","isCloseToBottom","layoutMeasurement","contentOffset","contentSize","paddingToBottom","height","y","styles","container","nativeEvent","table","header","fontWeight","fontSize","textAlign","color","map","post","index","navigate","item","row","url","cell","title","created_at","author","StyleSheet","create","flex","padding","marginBottom","borderWidth","backgroundColor","borderLeftWidth","headerText","text","flexDirection"],"sources":["Base.tsx"],"sourcesContent":["import { StyleSheet, TouchableOpacity, ScrollView} from 'react-native';\r\nimport React, {useRef, useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\nimport { useNavigation } from '@react-navigation/native';\r\nimport { NativeStackNavigationProp } from '@react-navigation/native-stack/lib/typescript/src/types';\r\nimport { Table, Row, Col } from 'react-native-table-component';\r\nimport AsyncStorage from '@react-native-async-storage/async-storage';\r\n\r\nconst Base = () => {\r\n  const navigation = useNavigation<NativeStackNavigationProp<any>>();\r\n  interface Post {\r\n    url: string;\r\n    title: string;\r\n    created_at: string;\r\n    author: string;\r\n    objectID: string;\r\n  }\r\n  const [posts, setPosts] = useState<Post[]>([]);\r\n  const [currentpage, setPage] = useState(0);\r\n  const [fetched, setFetched] = useState(0);\r\n  const [loading, setLoading] = useState(false);\r\n  const currentPageRef = useRef(currentpage);\r\n  let delayTime: any;\r\n  const cache = 3600 * 1000;\r\n  const [hasMore, setHasMore] = useState(true);\r\n\r\n  useEffect(() => {\r\n    AsyncStorage.getItem('postsCache')\r\n      .then(data => {\r\n        if (data) {\r\n          const postsCache = JSON.parse(data);\r\n          const currentTime = new Date().getTime();\r\n          if (currentTime - postsCache.timestamp < cache) {\r\n            setPosts(postsCache.posts);\r\n          } else {\r\n            getData(currentpage);\r\n          }\r\n        } else {\r\n          getData(currentpage);\r\n        }\r\n      });\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!loading && hasMore) {\r\n      getData(currentpage);\r\n    }\r\n  }, [currentpage,loading])\r\n   \r\n  useEffect(() => {\r\n    delayTime = setTimeout(() => {\r\n      if (!loading) {\r\n        currentPageRef.current += 1;\r\n        setPage(currentPageRef.current);\r\n     }\r\n    }, 10000);\r\n\r\n    return () => clearTimeout(delayTime);\r\n  }, [currentpage, loading]);\r\n\r\n  const getData = async (currentpage: number) => {\r\n    setLoading(true);\r\n    const resultSet = await axios.get(`https://hn.algolia.com/api/v1/search_by_date?tags=story&page=${currentpage}&hitsPerPage=3`);\r\n    if (resultSet.data.hits.length > 0) {\r\n      setPosts([...posts, ...resultSet.data.hits]);\r\n      setPage(currentpage + 1);\r\n    } else {\r\n      setHasMore(false);\r\n    }\r\n    \r\n    setFetched(currentpage);\r\n    AsyncStorage.setItem('postsCache', JSON.stringify({\r\n      timestamp: new Date().getTime(),\r\n      posts: [...posts, ...resultSet.data.hits],\r\n    }));\r\n\r\n\r\n    setLoading(false);\r\n  };\r\n\r\n  const tableHead = ['URL', 'Title', 'Created at', 'Author'];\r\n\r\n  const isCloseToBottom = ({ layoutMeasurement, contentOffset, contentSize }: any) => {\r\n    const paddingToBottom = 50;\r\n    return layoutMeasurement.height + contentOffset.y >=\r\n      contentSize.height - paddingToBottom;\r\n  };\r\n\r\n  return (\r\n    <ScrollView style={styles.container}  onScroll={({ nativeEvent }) => {\r\n      if (isCloseToBottom(nativeEvent)) {\r\n        if (!loading && hasMore) {\r\n          if (fetched !== currentpage) {\r\n            getData(currentpage);\r\n          }\r\n        }\r\n      }\r\n    }}>\r\n      <Table style={styles.table}>\r\n        <Row data={tableHead} style={styles.header} textStyle={{\r\n          fontWeight: 'bold',\r\n          fontSize: 18,\r\n          textAlign: 'center',\r\n          color: 'black',\r\n        }} />\r\n\r\n        {posts.map((post,index) => (\r\n          <TouchableOpacity\r\n            key={index}\r\n            onPress={() => navigation.navigate('Raw JSON', { item: post })}\r\n            style={styles.row}\r\n          >\r\n            <Col data={[post.url]} textStyle={{ fontSize: 16,textAlign: 'center',color: 'black', }} style={styles.cell } />\r\n            <Col data={[post.title]} textStyle={{ fontSize: 16,textAlign: 'center',color: 'black',  }} style={styles.cell }/>\r\n            <Col data={[post.created_at]} textStyle={{ fontSize: 16,textAlign: 'center',color: 'black',  }} style={styles.cell }/>\r\n            <Col data={[post.author]} textStyle={{ fontSize: 16,textAlign: 'center',color: 'black',  }} style={styles.cell }/>\r\n          </TouchableOpacity>\r\n        ))}\r\n      </Table>\r\n    </ScrollView>\r\n  );\r\n};\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    padding: 10,\r\n  },\r\n  table: {\r\n    marginBottom: 10,\r\n  },\r\n  cell: {\r\n    borderWidth: 1,\r\n  },\r\n  header: {\r\n    backgroundColor: 'lightgray',\r\n    height: 50,\r\n    borderWidth: 1,\r\n    borderLeftWidth: 1,\r\n  },\r\n  headerText: {\r\n    fontWeight: 'bold',\r\n    fontSize: 18,\r\n    textAlign: 'center',\r\n    color: 'black',\r\n  },\r\n  text: {\r\n    fontSize: 16,\r\n    textAlign: 'center',\r\n    color: 'black',\r\n  },\r\n    row: {\r\n      flex: 1,\r\n      flexDirection: 'row',\r\n  }\r\n});\r\nexport default Base;"],"mappings":"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"}